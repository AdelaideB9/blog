<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Not So Standard Substitution Cipher - DuckCTF 2023 | AdelaideB9 Blog</title><meta name=keywords content><meta name=description content="I made a machine to implement a substitution cipher. The only issue is that it seemed to encrypt everything in sight, including my flag and all other random stuff. Each line in the attached file is a new piece of encoded information. Please save my flag! The flag will not be encased in `quack{...}`, but it will be the only reasonable text."><meta name=author content="lachlan"><link rel=canonical href=https://blog.adelaideb9.com/posts/2023/duckctf/not-so-standard-substitution-cipher/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.adelaideb9.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.adelaideb9.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.adelaideb9.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.adelaideb9.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.adelaideb9.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})'></script><meta property="og:title" content="Not So Standard Substitution Cipher - DuckCTF 2023"><meta property="og:description" content="I made a machine to implement a substitution cipher. The only issue is that it seemed to encrypt everything in sight, including my flag and all other random stuff. Each line in the attached file is a new piece of encoded information. Please save my flag! The flag will not be encased in `quack{...}`, but it will be the only reasonable text."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.adelaideb9.com/posts/2023/duckctf/not-so-standard-substitution-cipher/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Not So Standard Substitution Cipher - DuckCTF 2023"><meta name=twitter:description content="I made a machine to implement a substitution cipher. The only issue is that it seemed to encrypt everything in sight, including my flag and all other random stuff. Each line in the attached file is a new piece of encoded information. Please save my flag! The flag will not be encased in `quack{...}`, but it will be the only reasonable text."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.adelaideb9.com/posts/"},{"@type":"ListItem","position":2,"name":"Not So Standard Substitution Cipher - DuckCTF 2023","item":"https://blog.adelaideb9.com/posts/2023/duckctf/not-so-standard-substitution-cipher/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Not So Standard Substitution Cipher - DuckCTF 2023","name":"Not So Standard Substitution Cipher - DuckCTF 2023","description":"I made a machine to implement a substitution cipher. The only issue is that it seemed to encrypt everything in sight, including my flag and all other random stuff. Each line in the attached file is a new piece of encoded information. Please save my flag! The flag will not be encased in `quack{...}`, but it will be the only reasonable text.","keywords":[],"articleBody":"We are given a file with 10,000 lines, each of which is a new piece of data encrypted with a substitution cipher with a different key. One of these lines is the flag, and the rest are just random characters.\nTo filter the rubbish out from the flag, we can use frequency analysis – as a substitution cipher will not change the frequency of characters.\nIdeally, we do not want to be comparing the character frequency distributions by hand. As such, we will want some way to rank each line in terms of their likelihood of being encrypted English – i.e. some way to compare the frequency of English characters to the frequency of characters in each line. While there are numerous ways to do this, as the mathematician I am, I opted to compute the Kullback–Leibler divergence for each line. This quantity is essentially a measure of the difference between two distributions and is given by the equation\n$$D_{KL}(P||Q) = -\\sum_{x} P(x) \\log \\left(\\frac{Q(x)}{P(x)}\\right)$$,\nwhere $P$ and $Q$ are the probability distributions of interest. Hence, if we calculate the probability of each character occurring on each line and apply this formula along with the expected character frequency for English, we should see that the flag has the lowest divergence as it is the only data that is English. The following script does just that;\nfrom collections import Counter from math import log import re def getProbDist(s): n = len(s) freq = Counter(s) prob = [i/n for i in freq.values()] prob = sorted(prob, reverse=True) return prob def KLD(P,Q): div = 0 for i in range(min(len(P), len(Q))): div -= P[i] * log(Q[i] / P[i]) return div def main(): # ==== Generating Probability Distribution From Sample Text ====== with open('englishSample.txt') as f: englishSample = f.read().lower() # Stripping all but a-z characters englishSample = re.sub(r'[\\[]|[^[a-z]]*', r'', englishSample) targetDist = getProbDist(englishSample) # Calculating Kullback–Leibler Divergence for each encrypted line rankings = {} with open('encrypted.txt') as f: for line in f: line = line.strip() dist = getProbDist(line) div = KLD(targetDist, dist) rankings[line] = div # Printing the most likely English string encrypted rankings = dict(sorted(rankings.items(), key=lambda item: item[1])) print(list(rankings.keys())[0]) if __name__ == \"__main__\": main() Running this we find the most likely encrypted English string to be\ntgetrprgrpzvpttgtnkorpehkrzjfkdgkvnbyvyhbtptyvsikfkpttzmkjphhkfnzvrkvrrzpvnfkytkrikhkvxrizjrikjhyxpvhpvkyfyhxkefyriknybhkbiymphrzvrikzfkmvymksyjrkfrikmyrikmyrpnpyvtyfrigfnybhkbyvsqphhpymfzqyviymphrzvtryrktriyrkukfbtdgyfkmyrfplzukfynzmmgryrpukfpvxtgniytrikfkyhzfnzmohklvgmekftzfrikpvrkxkfttyrptjpktprtzqvniyfynrkfptrpnkdgyrpzv Decrypting this using an online tool gives us\nsubstitutionissusceptibletofrequencyanalysisandhereissomefillercontenttoincreasethelengthoftheflaginlinearalgebrathecayleyhamiltontheoremnamedafterthemathematiciansarthurcayleyandwilliamrowanhamiltonstatesthateverysquarematrikoveracommutativeringsuchastherealorcompleknumbersortheintegerssatisfiesitsowncharacteristicequation Which is indeed English text and the flag for the challenge.\n","wordCount":"392","inLanguage":"en","datePublished":"2023-08-04T00:00:00Z","dateModified":"2023-08-04T00:00:00Z","author":{"@type":"Person","name":"lachlan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.adelaideb9.com/posts/2023/duckctf/not-so-standard-substitution-cipher/"},"publisher":{"@type":"Organization","name":"AdelaideB9 Blog","logo":{"@type":"ImageObject","url":"https://blog.adelaideb9.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.adelaideb9.com/ accesskey=h title="AdelaideB9 Blog (Alt + H)">AdelaideB9 Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.adelaideb9.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.adelaideb9.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.adelaideb9.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.adelaideb9.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.adelaideb9.com/posts/>Posts</a></div><h1 class=post-title>Not So Standard Substitution Cipher - DuckCTF 2023</h1><div class=post-description>I made a machine to implement a substitution cipher. The only issue is that it seemed to encrypt everything in sight, including my flag and all other random stuff. Each line in the attached file is a new piece of encoded information. Please save my flag! The flag will not be encased in `quack{...}`, but it will be the only reasonable text.</div><div class=post-meta><span title='2023-08-04 00:00:00 +0000 UTC'>August 4, 2023</span>&nbsp;·&nbsp;lachlan</div></header><div class=post-content><p>We are given a file with 10,000 lines, each of which is a new piece of data encrypted with a substitution cipher with a different key. One of these lines is the flag, and the rest are just random characters.</p><p>To filter the rubbish out from the flag, we can use frequency analysis &ndash; as a substitution cipher will not change the frequency of characters.</p><p>Ideally, we do not want to be comparing the character frequency distributions by hand. As such, we will want some way to rank each line in terms of their likelihood of being encrypted English &ndash; i.e. some way to compare the frequency of English characters to the frequency of characters in each line. While there are numerous ways to do this, as the mathematician I am, I opted to compute the <a href=https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence>Kullback–Leibler divergence</a> for each line. This quantity is essentially a measure of the difference between two distributions and is given by the equation</p><p>$$D_{KL}(P||Q) = -\sum_{x} P(x) \log \left(\frac{Q(x)}{P(x)}\right)$$,</p><p>where $P$ and $Q$ are the probability distributions of interest. Hence, if we calculate the probability of each character occurring on each line and apply this formula along with the expected character frequency for English, we should see that the flag has the lowest divergence as it is the only data that is English. The following script does just that;</p><pre tabindex=0><code class="language-python=" data-lang="python=">from collections import Counter
from math import log
import re

def getProbDist(s):
    n = len(s)
    freq = Counter(s)
    prob = [i/n for i in freq.values()]
    prob = sorted(prob, reverse=True)

    return prob

def KLD(P,Q):
    div = 0
    for i in range(min(len(P), len(Q))):
        div -= P[i] * log(Q[i] / P[i])

    return div

def main():
    # ==== Generating Probability Distribution From Sample Text ======
    with open(&#39;englishSample.txt&#39;) as f:
        englishSample = f.read().lower()

    # Stripping all but a-z characters
    englishSample = re.sub(r&#39;[\[]|[^[a-z]]*&#39;, r&#39;&#39;, englishSample)
    targetDist = getProbDist(englishSample)

    # Calculating Kullback–Leibler Divergence for each encrypted line
    rankings = {}

    with open(&#39;encrypted.txt&#39;) as f:
        for line in f:
            line = line.strip()
            dist = getProbDist(line)
            div = KLD(targetDist, dist)
            rankings[line] = div

    # Printing the most likely English string encrypted
    rankings = dict(sorted(rankings.items(), key=lambda item: item[1]))
    print(list(rankings.keys())[0])


if __name__ == &#34;__main__&#34;:
    main()
</code></pre><p>Running this we find the most likely encrypted English string to be</p><pre tabindex=0><code>tgetrprgrpzvpttgtnkorpehkrzjfkdgkvnbyvyhbtptyvsikfkpttzmkjphhkfnzvrkvrrzpvnfkytkrikhkvxrizjrikjhyxpvhpvkyfyhxkefyriknybhkbiymphrzvrikzfkmvymksyjrkfrikmyrikmyrpnpyvtyfrigfnybhkbyvsqphhpymfzqyviymphrzvtryrktriyrkukfbtdgyfkmyrfplzukfynzmmgryrpukfpvxtgniytrikfkyhzfnzmohklvgmekftzfrikpvrkxkfttyrptjpktprtzqvniyfynrkfptrpnkdgyrpzv
</code></pre><p>Decrypting this using an <a href=https://www.dcode.fr/monoalphabetic-substitution>online tool</a> gives us</p><pre tabindex=0><code>substitutionissusceptibletofrequencyanalysisandhereissomefillercontenttoincreasethelengthoftheflaginlinearalgebrathecayleyhamiltontheoremnamedafterthemathematiciansarthurcayleyandwilliamrowanhamiltonstatesthateverysquarematrikoveracommutativeringsuchastherealorcompleknumbersortheintegerssatisfiesitsowncharacteristicequation
</code></pre><p>Which is indeed English text and the flag for the challenge.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.adelaideb9.com/>AdelaideB9 Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>