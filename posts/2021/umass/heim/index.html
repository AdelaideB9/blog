<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Heim - UMassCTF '21 | AdelaideB9 Blog</title><meta name=keywords content><meta name=description content="Only those who BEARER a token may enter! A web exploitation category challenge on intercepting and forging JSON Web Token from a debugging endpoint to bypass authentication."><meta name=author content="samiko"><link rel=canonical href=https://blog.adelaideb9.com/posts/2021/umass/heim/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.adelaideb9.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.adelaideb9.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.adelaideb9.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.adelaideb9.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.adelaideb9.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.103.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})'></script><meta property="og:title" content="Heim - UMassCTF '21"><meta property="og:description" content="Only those who BEARER a token may enter! A web exploitation category challenge on intercepting and forging JSON Web Token from a debugging endpoint to bypass authentication."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.adelaideb9.com/posts/2021/umass/heim/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-29T01:30:00+00:00"><meta property="article:modified_time" content="2021-03-29T01:30:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Heim - UMassCTF '21"><meta name=twitter:description content="Only those who BEARER a token may enter! A web exploitation category challenge on intercepting and forging JSON Web Token from a debugging endpoint to bypass authentication."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.adelaideb9.com/posts/"},{"@type":"ListItem","position":2,"name":"Heim - UMassCTF '21","item":"https://blog.adelaideb9.com/posts/2021/umass/heim/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Heim - UMassCTF '21","name":"Heim - UMassCTF \u002721","description":"Only those who BEARER a token may enter! A web exploitation category challenge on intercepting and forging JSON Web Token from a debugging endpoint to bypass authentication.","keywords":[],"articleBody":"The Heim Upon navigating to the given URL, we’re met with a login form which asks the user for a “name”, claiming that “only those who BEARER a token may enter”.\nAfter entering a name and hitting “Enter”, we are then redirected to the /auth/authorised page containing our access token:\nThis likely suggests that we’re dealing with some type of bearer token authentication. Bearer tokens allow requests to authenticate by using a cryptic string generated and encrypted by the server, such as a JSON Web Token, which looks something akin to this:\nThis token is then included in the HTTP header, in the format of:\nAuthorization: Bearer \u003cJWT\u003e Intercepting requests with Burp Suite Let’s intercept the outbound POST request made to /auth with Burp Suite’s proxy feature, and forward the request to the repeater with Ctrl-R to try and figure out what is happening behind the scenes:\nWe see that the browser first makes a POST request to /auth with the form data, and is then redirected to the URL:\n/auth?access_token=\u0026jwt_secret_key=arottenbranchwillbefoundineverytree\nLeaked at the end of the redirect URL is the jwt_secret_key, which is used for encrypting JSON Web Tokens:\narottenbranchwillbefoundineverytree\nWhile looking for more API endpoints on the website by trying related keywords, we stumbled upon /heim, which returned:\n{ \"msg\": \"Missing Authorization Header\" } This means that the web server is expecting a Bearer token in the HTTP header, so let’s add that to our request in Burp Suite’s repeater:\nWe received a massive message encoded in base64, let’s decode it:\n$ echo \"ewogICAgIm...AgIH0KfQ==\" | base64 -d\n{ \"api\": { \"v1\": { \"/auth\": { \"get\": { \"summary\": \"Debugging method for authorization post\", \"security\": \"None\", \"parameters\": { \"access_token\": { \"required\": true, \"description\": \"Access token from recently authorized Viking\", \"in\": \"path\", }, \"jwt_secret_key\": { \"required\": false, \"description\": \"Debugging - should be removed in prod Heim\", \"in\": \"path\" } } }, \"post\": { \"summary\": \"Authorize yourself as a Viking\", \"security\": \"None\", \"parameters\": { \"username\": { \"required\": true, \"description\": \"Your Viking name\", \"in\": \"body\", \"content\": \"multipart/x-www-form-urlencoded\" } } } }, \"/heim\": { \"get\": { \"summary\": \"List the endpoints available to named Vikings\", \"security\": \"BearerAuth\" } }, \"/flag\": { \"get\": { \"summary\": \"Retrieve the flag\", \"security\": \"BearerAuth\" } } } } } Nice! We have obtained a list of all available endpoints and now know the flag is located at /flag, and that the GET method for /auth was originally meant to be a debugging endpoint, explaining why jwt_secret_key was leaked in the redirect URL.\nMaking a GET request to /flag with our Bearer token returns:\n{ \"msg\": \"You are not worthy. Only the AllFather Odin may view the flag\" } Seems like only Odin is worthy enough to view the flag! Also, trying to submit “odin” as the name in the login form returns:\n{ \"error\": \"You are not wise enough to be Odin\" } Though, since we can obtain a sample access token and are in possession of the secret key, we can forge our own tokens to authenticate as the Odin user.\nForging Odin’s token Using CyberChef tool, we can easily read the payload of our own JWT string with the “JWT decode” function:\nWe see that the JWT payload contains the following data:\n{ \"fresh\": false, \"iat\": 1617017482, \"jti\": \"380b9f5c-fb31-479e-a189-59e2c8040453\", \"nbf\": 1617017482, \"type\": \"access\", \"sub\": \"samiko\", \"exp\": 1617018382 } Of all variables, sub (subject) and exp (expiration time) are the ones that appear most interesting to us, since we want to forge a token for Odin (that never expires!), so let’s modify the payload to the following:\n{ \"fresh\": false, \"iat\": 1617017482, \"jti\": \"380b9f5c-fb31-479e-a189-59e2c8040453\", \"nbf\": 1617017482, \"type\": \"access\", \"sub\": \"odin\", \"exp\": 9999999999 } Using the “JWT Sign” function with the leaked jwt_secret_key and HS256 as parameters, we get the token:\nUsing the forged token in the HTTP header as a Bearer token, we make a GET request to /flag:\nVoila! We got the flag:\nUMASS{liveheim_laughheim_loveheim} Resources https://swagger.io/docs/specification/authentication/bearer-authentication/ https://research.securitum.com/jwt-json-web-token-security/ https://gchq.github.io/CyberChef/ ","wordCount":"650","inLanguage":"en","datePublished":"2021-03-29T01:30:00Z","dateModified":"2021-03-29T01:30:00Z","author":{"@type":"Person","name":"samiko"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.adelaideb9.com/posts/2021/umass/heim/"},"publisher":{"@type":"Organization","name":"AdelaideB9 Blog","logo":{"@type":"ImageObject","url":"https://blog.adelaideb9.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.adelaideb9.com/ accesskey=h title="AdelaideB9 Blog (Alt + H)">AdelaideB9 Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.adelaideb9.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.adelaideb9.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.adelaideb9.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.adelaideb9.com/>Home</a>&nbsp;»&nbsp;<a href=https://blog.adelaideb9.com/posts/>Posts</a></div><h1 class=post-title>Heim - UMassCTF '21</h1><div class=post-description>Only those who BEARER a token may enter! A web exploitation category challenge on intercepting and forging JSON Web Token from a debugging endpoint to bypass authentication.</div><div class=post-meta><span title='2021-03-29 01:30:00 +0000 UTC'>March 29, 2021</span>&nbsp;·&nbsp;samiko</div></header><div class=post-content><h2 id=the-heim>The Heim<a hidden class=anchor aria-hidden=true href=#the-heim>#</a></h2><p>Upon navigating to the given URL, we&rsquo;re met with a login form which asks the user for a &ldquo;name&rdquo;, claiming that &ldquo;only those who BEARER a token may enter&rdquo;.</p><p><img loading=lazy src=https://i.imgur.com/96m81yH.png alt=https://i.imgur.com/96m81yH.png></p><p>After entering a name and hitting &ldquo;Enter&rdquo;, we are then redirected to the <code>/auth/authorised</code> page containing our access token:</p><p><img loading=lazy src=https://i.imgur.com/s2PtrcI.png alt=https://i.imgur.com/s2PtrcI.png></p><p>This likely suggests that we&rsquo;re dealing with some type of bearer token authentication. Bearer tokens allow requests to authenticate by using a cryptic string generated and encrypted by the server, such as a JSON Web Token, which looks something akin to this:</p><p><img loading=lazy src=https://i.imgur.com/IVE3srk.png alt=https://i.imgur.com/IVE3srk.png></p><p>This token is then included in the HTTP header, in the format of:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>Authorization: Bearer &lt;<span style=color:#f92672>JWT</span>&gt;
</span></span></code></pre></div><h2 id=intercepting-requests-with-burp-suite>Intercepting requests with Burp Suite<a hidden class=anchor aria-hidden=true href=#intercepting-requests-with-burp-suite>#</a></h2><p>Let&rsquo;s intercept the outbound POST request made to <code>/auth</code> with Burp Suite&rsquo;s proxy feature, and forward the request to the repeater with <code>Ctrl-R</code> to try and figure out what is happening behind the scenes:</p><p><img loading=lazy src=https://i.imgur.com/EZ3LsiC.png alt=https://i.imgur.com/EZ3LsiC.png></p><p>We see that the browser first makes a POST request to <code>/auth</code> with the form data, and is then redirected to the URL:</p><p><code>/auth?access_token=&lt;JWT>&jwt_secret_key=arottenbranchwillbefoundineverytree</code></p><p>Leaked at the end of the redirect URL is the <code>jwt_secret_key</code>, which is used for encrypting JSON Web Tokens:</p><p><code>arottenbranchwillbefoundineverytree</code></p><p>While looking for more API endpoints on the website by trying related keywords, we stumbled upon <code>/heim</code>, which returned:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;Missing Authorization Header&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This means that the web server is expecting a Bearer token in the HTTP header, so let&rsquo;s add that to our request in Burp Suite&rsquo;s repeater:</p><p><img loading=lazy src=https://i.imgur.com/HR6kSKQ.png alt=https://i.imgur.com/HR6kSKQ.png></p><p>We received a massive message encoded in base64, let&rsquo;s decode it:</p><p><code>$ echo "ewogICAgIm...AgIH0KfQ==" | base64 -d</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;api&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;v1&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;/auth&#34;</span>: {
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;get&#34;</span>: {
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;summary&#34;</span>: <span style=color:#e6db74>&#34;Debugging method for authorization post&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;security&#34;</span>: <span style=color:#e6db74>&#34;None&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;parameters&#34;</span>: {
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;access_token&#34;</span>: {
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;required&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Access token from recently authorized Viking&#34;</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;in&#34;</span>: <span style=color:#e6db74>&#34;path&#34;</span>,
</span></span><span style=display:flex><span>                      },
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;jwt_secret_key&#34;</span>: {
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;required&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Debugging - should be removed in prod Heim&#34;</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;in&#34;</span>: <span style=color:#e6db74>&#34;path&#34;</span>
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                  }
</span></span><span style=display:flex><span>              },
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;post&#34;</span>: {
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;summary&#34;</span>: <span style=color:#e6db74>&#34;Authorize yourself as a Viking&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;security&#34;</span>: <span style=color:#e6db74>&#34;None&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;parameters&#34;</span>: {
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&#34;username&#34;</span>: {
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;required&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Your Viking name&#34;</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;in&#34;</span>: <span style=color:#e6db74>&#34;body&#34;</span>,
</span></span><span style=display:flex><span>                          <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;multipart/x-www-form-urlencoded&#34;</span>
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                  }
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;/heim&#34;</span>: {
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;get&#34;</span>: {
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;summary&#34;</span>: <span style=color:#e6db74>&#34;List the endpoints available to named Vikings&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;security&#34;</span>: <span style=color:#e6db74>&#34;BearerAuth&#34;</span>
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;/flag&#34;</span>: {
</span></span><span style=display:flex><span>              <span style=color:#f92672>&#34;get&#34;</span>: {
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;summary&#34;</span>: <span style=color:#e6db74>&#34;Retrieve the flag&#34;</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&#34;security&#34;</span>: <span style=color:#e6db74>&#34;BearerAuth&#34;</span>
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Nice! We have obtained a list of all available endpoints and now know the flag is located at <code>/flag</code>, and that the GET method for <code>/auth</code> was originally meant to be a debugging endpoint, explaining why <code>jwt_secret_key</code> was leaked in the redirect URL.</p><p>Making a GET request to <code>/flag</code> with our Bearer token returns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;You are not worthy. Only the AllFather Odin may view the flag&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Seems like only Odin is worthy enough to view the flag! Also, trying to submit &ldquo;odin&rdquo; as the name in the login form returns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;error&#34;</span>: <span style=color:#e6db74>&#34;You are not wise enough to be Odin&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Though, since we can obtain a sample access token and are in possession of the secret key, we can forge our own tokens to authenticate as the Odin user.</p><h2 id=forging-odins-token>Forging Odin&rsquo;s token<a hidden class=anchor aria-hidden=true href=#forging-odins-token>#</a></h2><p>Using <a href=https://gchq.github.io/CyberChef/>CyberChef</a> tool, we can easily read the payload of our own JWT string with the &ldquo;JWT decode&rdquo; function:</p><p><img loading=lazy src=https://i.imgur.com/gRvcmbl.png alt=https://i.imgur.com/gRvcmbl.png></p><p>We see that the JWT payload contains the following data:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;fresh&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;iat&#34;</span>: <span style=color:#ae81ff>1617017482</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;jti&#34;</span>: <span style=color:#e6db74>&#34;380b9f5c-fb31-479e-a189-59e2c8040453&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;nbf&#34;</span>: <span style=color:#ae81ff>1617017482</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;access&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sub&#34;</span>: <span style=color:#e6db74>&#34;samiko&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;exp&#34;</span>: <span style=color:#ae81ff>1617018382</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Of all variables, <code>sub</code> (subject) and <code>exp</code> (expiration time) are the ones that appear most interesting to us, since we want to forge a token for Odin (that never expires!), so let&rsquo;s modify the payload to the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;fresh&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;iat&#34;</span>: <span style=color:#ae81ff>1617017482</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;jti&#34;</span>: <span style=color:#e6db74>&#34;380b9f5c-fb31-479e-a189-59e2c8040453&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;nbf&#34;</span>: <span style=color:#ae81ff>1617017482</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;access&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sub&#34;</span>: <span style=color:#e6db74>&#34;odin&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;exp&#34;</span>: <span style=color:#ae81ff>9999999999</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Using the &ldquo;JWT Sign&rdquo; function with the leaked <code>jwt_secret_key</code> and HS256 as parameters, we get the token:</p><p><img loading=lazy src=https://i.imgur.com/AEjoHH4.png alt=https://i.imgur.com/AEjoHH4.png></p><p>Using the forged token in the HTTP header as a Bearer token, we make a GET request to <code>/flag</code>:</p><p><img loading=lazy src=https://i.imgur.com/Tq2jaX7.png alt=https://i.imgur.com/Tq2jaX7.png></p><p>Voila! We got the flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>UMASS</span>{<span style=color:#960050;background-color:#1e0010>liveheim_laughheim_loveheim</span>}
</span></span></code></pre></div><h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2><ol><li><a href=https://swagger.io/docs/specification/authentication/bearer-authentication/>https://swagger.io/docs/specification/authentication/bearer-authentication/</a></li><li><a href=https://research.securitum.com/jwt-json-web-token-security/>https://research.securitum.com/jwt-json-web-token-security/</a></li><li><a href=https://gchq.github.io/CyberChef/>https://gchq.github.io/CyberChef/</a></li></ol></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.adelaideb9.com/>AdelaideB9 Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>